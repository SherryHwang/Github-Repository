C51 COMPILER V9.56.0.0   MAIN                                                              07/24/2018 01:06:59 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\MAIN.obj
COMPILER INVOKED BY: D:\Software\C51\C51\BIN\C51.EXE USER\MAIN.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\IIC;.\LCD1602;.\DELAY
                    -;.\PCF8591;.\SENSOR) DEBUG OBJECTEXTEND PRINT(.\Listings\MAIN.lst) TABS(2) OBJECT(.\Objects\MAIN.obj)

line level    source

   1          #include "reg52.h"
   2          #include "SENSOR.h"
   3          #include "Delay.h"
   4          #include "string.h"
   5          
   6          uchar data_come = 0; //数据帧开始传输标志
   7          uchar data_flag = 0; //帧长度
   8          uchar is_Start= 0;   //各个模块开始运行标志
   9          uchar num = 0;
  10          uchar  a[10];       //用于存储串口发送的信息
  11          uchar index = 0;
  12          void SerialInit()     
  13          {
  14   1        TMOD = 0x20;    //T1工作模式2  8位自动重装
  15   1        TH1 = 0xfd;
  16   1        TL1 = 0xfd;   //比特率9600
  17   1        TR1 = 1;    //启动T1定时器
  18   1        SM0 = 0;
  19   1        SM1 = 1;    //串口工作方式1 10位异步
  20   1        REN = 1;    //串口允许接收
  21   1        EA  = 1;    //开总中断
  22   1        ES  = 1;    //串口中断打开
  23   1      }
  24          void main()
  25          {
  26   1        uchar len = 0;
  27   1        SerialInit();
  28   1        while(1)
  29   1        {
  30   2          PraseData();
*** WARNING C206 IN LINE 30 OF USER\MAIN.c: 'PraseData': missing function-prototype
  31   2          //SENSOR_RUN();
  32   2          Delay(10);
  33   2        }
  34   1      }
  35          void Serail_Proc() interrupt 4
  36          {
  37   1        uchar i;
  38   1        if(RI)
  39   1        {
  40   2          RI = 0;
  41   2          num = SBUF;
  42   2          Delay(5);
  43   2          SBUF = num;
  44   2          while(!TI);
  45   2          TI = 0;
  46   2          
  47   2          if(num == 0)
  48   2          {
  49   3            if(data_come && !data_flag)  //第二位数据为0  ，停止帧
  50   3            {
  51   4              data_come = 0;
  52   4              is_Start = 0;
  53   4            }
C51 COMPILER V9.56.0.0   MAIN                                                              07/24/2018 01:06:59 PAGE 2   

  54   3            else if(!data_come)
  55   3              data_come = 1;
  56   3          }
  57   2          else
  58   2          {
  59   3            data_flag = 1;    //通讯帧
  60   3            if(data_come)
  61   3              is_Start = 1;
  62   3          }
  63   2          
  64   2          if(is_Start)
  65   2          {
  66   3            
  67   3            if(num != 0xFF)   //不是最后一个数据
  68   3            {
  69   4              a[index++] = num;  //数据存入数组
  70   4            }
  71   3            else             //最后一个数据
  72   3            {
  73   4              index  = 0;    //数组下标置0
  74   4              data_flag = 0; //默认为停止帧
  75   4              data_come = 0; //帧开始标志置为0
  76   4              
  77   4              for(i = 0;i<5;i++)
  78   4              {
  79   5                SBUF = 0xFF;
  80   5                while(!TI);
  81   5                TI = 0;
  82   5              }
  83   4              for(i = 0;i<10;i++)  //将接收到的数据发送出
  84   4              {
  85   5                SBUF = a[i];
  86   5                while(!TI);
  87   5                TI = 0;
  88   5              }
  89   4            }
  90   3          }
  91   2        }
  92   1        
  93   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    218    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
